# 自动化任务生成器 使用说明

## 目录

- [简介](#简介)
- [环境要求](#环境要求)
- [安装步骤](#安装步骤)
- [快速开始](#快速开始)
- [界面介绍](#界面介绍)
- [步骤类型详解](#步骤类型详解)
- [操作指南](#操作指南)
- [定时任务](#定时任务)
- [OCR 配置](#ocr-配置)
- [常见问题](#常见问题)

---

## 简介

**自动化任务生成器** 是一个可视化的桌面自动化工具，让你无需编写代码即可创建自动化任务流程。

**主要功能：**
- 可视化拖拽式配置自动化步骤
- 支持图片识别点击、键盘输入、OCR 文字识别等
- 实时预览生成的 Python 代码
- 任务保存/加载，支持导出独立脚本
- Windows 定时任务集成

---

## 环境要求

- **操作系统：** Windows 10/11
- **Python 版本：** Python 3.8 或更高
- **屏幕分辨率：** 建议 1920x1080 或更高

---

## 安装步骤

### 第一步：安装 Python

如果尚未安装 Python，请从 [python.org](https://www.python.org/downloads/) 下载安装。

> **重要：** 安装时勾选 "Add Python to PATH"

### 第二步：安装依赖包

打开命令提示符（CMD）或 PowerShell，执行以下命令：

```bash
pip install customtkinter keyboard pyautogui pyperclip pillow numpy opencv-python requests
```

**依赖说明：**

| 包名 | 用途 |
|------|------|
| customtkinter | 现代化 GUI 界面框架 |
| keyboard | 录制按键/组合键 |
| pyautogui | 鼠标键盘自动化控制 |
| pyperclip | 剪贴板读写操作 |
| pillow | 屏幕截图功能 |
| numpy | 图像数据处理 |
| opencv-python | 图片模板匹配 |
| requests | HTTP 请求（OCR、推送） |

### 第三步：验证安装

```bash
python -c "import customtkinter; import pyautogui; print('安装成功!')"
```

---

## 快速开始

### 启动程序

```bash
python auto_task_gui.py
```

### 5 分钟创建第一个任务

**示例：自动打开网页并点击按钮**

1. **启动程序** - 运行 `python auto_task_gui.py`

2. **添加步骤** - 点击左侧「打开URL」按钮
   - 在右侧属性编辑器中输入网址
   - 点击「保存修改」

3. **添加等待** - 点击左侧「等待时间」按钮
   - 设置等待 3 秒（等待页面加载）
   - 点击「保存修改」

4. **截取按钮图片** - 运行截图工具
   ```bash
   python capture_tool.py
   ```
   - 选择「单张截图模式」
   - 选择「自定义截图」
   - 输入图片名称（如 `my_button`）
   - 将鼠标移到目标按钮上，等待截图

5. **添加点击步骤** - 回到 GUI，点击「点击图片」
   - 点击「浏览」选择刚才截取的图片
   - 点击「保存修改」

6. **运行测试** - 点击工具栏「运行」按钮

7. **保存任务** - 点击「保存」，选择保存位置

---

## 界面介绍

```
┌─────────────────────────────────────────────────────────────────┐
│  [新建] [打开] [保存] [运行] [生成代码] [定时任务]              │ ← 工具栏
├────────────┬────────────────────────────────────────────────────┤
│            │                                                    │
│  步骤类型  │                   步骤列表                         │
│            │  ☑ 1. [打开URL] https://example.com...            │
│ ┌────────┐ │  ☑ 2. [等待时间] 3秒                              │
│ │📌点击图片│ │  ☑ 3. [点击图片] images/btn.png...               │
│ │⏳等待图片│ │  ☐ 4. [输入文本] (已禁用)                        │
│ │👆长按    │ │                                                    │
│ │⌨️输入文本│ ├────────────────────────────────────────────────────┤
│ │⏱️等待时间│ │                                                    │
│ │🌐打开URL │ │                   属性编辑器                       │
│ │🚀打开程序│ │                                                    │
│ │📋粘贴    │ │  图片路径: [images/btn.png    ] [浏览]            │
│ │📋设置剪贴│ │  置信度:   [0.8              ]                    │
│ │🔤OCR识别 │ │  超时(秒): [30               ]                    │
│ │⌨️按键操作│ │                                                    │
│ │📱微信推送│ │  [保存修改]                                       │
│ └────────┘ │                                                    │
│            │  [↑] [↓] [复制] [启用/禁用] [删除]                 │
├────────────┴────────────────────────────────────────────────────┤
│                         代码预览                                │
│  # -*- coding: utf-8 -*-                                        │
│  import time                                                    │
│  import pyautogui                                               │
│  ...                                                            │
└─────────────────────────────────────────────────────────────────┘
```

### 区域说明

| 区域 | 功能 |
|------|------|
| **工具栏** | 新建、打开、保存任务；运行、导出代码；定时任务管理 |
| **步骤类型面板** | 点击添加对应类型的步骤到列表 |
| **步骤列表** | 显示所有已添加的步骤，点击选中进行编辑 |
| **属性编辑器** | 编辑选中步骤的参数，调整顺序、复制、删除 |
| **代码预览** | 实时显示生成的 Python 代码 |

---

## 步骤类型详解

### 📌 点击图片

**功能：** 在屏幕上查找指定图片，找到后点击其中心位置

**参数：**
| 参数 | 说明 | 默认值 |
|------|------|--------|
| 图片路径 | 要查找的图片文件 | - |
| 置信度 | 匹配精度 (0-1)，越高越严格 | 0.8 |
| 超时(秒) | 最长等待时间 | 30 |

**使用技巧：**
- 置信度建议设置 0.7-0.85
- 截图时只截取按钮/图标本身，不要包含太多背景
- 如果匹配失败，尝试降低置信度或重新截图

---

### ⏳ 等待图片

**功能：** 等待指定图片出现在屏幕上（不点击）

**参数：** 同「点击图片」

**使用场景：**
- 等待页面加载完成
- 等待弹窗出现
- 作为流程控制的检查点

---

### 👆 长按

**功能：** 在指定位置长按鼠标

**参数：**
| 参数 | 说明 | 默认值 |
|------|------|--------|
| 时长(秒) | 按住的时间 | 1.0 |
| X坐标 | 点击位置 X（0=当前鼠标位置） | 0 |
| Y坐标 | 点击位置 Y（0=当前鼠标位置） | 0 |

---

### ⌨️ 输入文本

**功能：** 在当前焦点位置输入文字（支持中文）

**参数：**
| 参数 | 说明 | 默认值 |
|------|------|--------|
| 文本内容 | 要输入的文字 | - |
| 先清空 | 输入前是否先全选清空 | 是 |

**原理：** 通过剪贴板粘贴实现，完美支持中文输入

---

### ⏱️ 等待时间

**功能：** 暂停执行指定秒数

**参数：**
| 参数 | 说明 | 默认值 |
|------|------|--------|
| 秒数 | 等待的时间 | 3 |

**使用场景：**
- 等待页面加载
- 等待动画播放完成
- 给用户反应时间

---

### 🌐 打开URL

**功能：** 使用默认浏览器打开网址

**参数：**
| 参数 | 说明 | 默认值 |
|------|------|--------|
| 网址 | 要打开的 URL | https:// |

---

### 🚀 打开程序

**功能：** 启动指定的可执行文件

**参数：**
| 参数 | 说明 | 默认值 |
|------|------|--------|
| 程序路径 | .exe 文件的完整路径 | - |

**示例：**
- `C:\Program Files\Google\Chrome\Application\chrome.exe`
- `C:\Windows\System32\notepad.exe`

---

### 📋 粘贴

**功能：** 执行 Ctrl+V 粘贴操作

**参数：** 无

---

### 📋 设置剪贴板

**功能：** 将指定内容复制到剪贴板

**参数：**
| 参数 | 说明 | 默认值 |
|------|------|--------|
| 内容 | 要复制的文本 | - |

---

### 🔤 OCR识别

**功能：** 识别屏幕指定区域的文字

**参数：**
| 参数 | 说明 | 默认值 |
|------|------|--------|
| 起始X | 区域左上角 X | 0 |
| 起始Y | 区域左上角 Y | 0 |
| 结束X | 区域右下角 X | 200 |
| 结束Y | 区域右下角 Y | 100 |
| 变量名 | 保存结果的变量名 | result |

**注意：** 需要配置 Umi-OCR，详见 [OCR 配置](#ocr-配置)

---

### ⌨️ 按键操作

**功能：** 模拟键盘按键或组合键

**参数：**
| 参数 | 说明 | 默认值 |
|------|------|--------|
| 按键 | 主按键名称 | enter |
| 组合键 | 修饰键（ctrl, alt, shift） | - |

**常用按键名：**
- 功能键：`enter`, `tab`, `escape`, `space`, `backspace`, `delete`
- 方向键：`up`, `down`, `left`, `right`
- 功能键：`f1` - `f12`

**组合键示例：**
- 复制：按键=`c`，组合键=`ctrl`
- 全选：按键=`a`，组合键=`ctrl`
- 保存：按键=`s`，组合键=`ctrl`
- 切换窗口：按键=`tab`，组合键=`alt`

**录制功能：**
- 点击「录制」按钮可自动捕获按键
- 点击「录制组合键」可捕获组合键

---

### 📱 微信推送

**功能：** 发送微信通知消息

**参数：**
| 参数 | 说明 | 默认值 |
|------|------|--------|
| 标题 | 消息标题 | 通知 |
| 内容 | 消息正文 | - |
| 令牌 | 推送服务的 Token | - |

**变量引用：**
在内容中可使用 `{变量名}` 引用 OCR 识别的结果：
- `{result}` - 默认 OCR 结果变量
- `{ocr_result}` - OCR 结果

---

## 操作指南

### 添加步骤

点击左侧「步骤类型面板」中的按钮，步骤会添加到列表末尾。

### 编辑步骤

1. 在「步骤列表」中点击要编辑的步骤
2. 在「属性编辑器」中修改参数
3. 点击「保存修改」按钮

### 调整顺序

选中步骤后，点击 `↑` 或 `↓` 按钮移动位置。

### 复制步骤

选中步骤后，点击「复制」按钮，会在列表末尾创建副本。

### 启用/禁用步骤

- 点击「启用/禁用」按钮切换状态
- 禁用的步骤显示为 ☐，运行时会跳过
- 用于临时跳过某些步骤进行调试

### 删除步骤

选中步骤后，点击红色「删除」按钮。

### 保存任务

1. 点击工具栏「保存」按钮
2. 选择保存位置（建议保存到 `tasks` 文件夹）
3. 文件格式为 `.json`

### 打开任务

1. 点击工具栏「打开」按钮
2. 选择之前保存的 `.json` 文件

### 运行任务

1. 点击工具栏「运行」按钮
2. 会打开新的命令行窗口执行任务
3. 执行完成后按任意键关闭窗口

### 导出代码

1. 点击工具栏「生成代码」按钮
2. 选择保存位置
3. 生成独立的 `.py` 脚本文件，可直接运行

---

## 截图工具使用

图片识别功能需要预先截取目标元素的图片模板。

### 启动截图工具

```bash
python capture_tool.py
```

### 截图模式

**1. 快速截图（推荐）**
- 将鼠标移动到目标元素中心
- 自动截取鼠标周围 100x100 像素区域

**2. 鼠标选区**
- 先将鼠标移到左上角，等待截取
- 再将鼠标移到右下角，完成截取

**3. 手动坐标**
- 输入精确的坐标值
- 格式：`x,y,size` 或 `x1,y1,x2,y2`

### 截图技巧

1. **只截取关键部分** - 按钮、图标本身，不要包含太多背景
2. **避免动态内容** - 不要截取包含数字、时间等变化内容的区域
3. **保持一致性** - 截图时的缩放比例要与运行时一致
4. **测试匹配** - 使用截图工具的「测试图片匹配」功能验证

---

## 定时任务

### 打开定时任务管理

点击工具栏「定时任务」按钮。

### 添加定时任务

1. 点击「浏览」选择已保存的任务文件（`.json`）
2. 输入运行时间（格式：`HH:MM`，如 `08:00`）
3. 输入任务名称（可选）
4. 点击「添加定时任务」

### 查看定时任务

任务列表会显示所有已添加的定时任务。

### 删除定时任务

1. 点击「删除选中」按钮
2. 输入要删除的任务序号

### 原理说明

定时任务使用 Windows 任务计划程序（Task Scheduler）实现，任务会在系统后台按时执行。

---

## OCR 配置

OCR 识别功能使用 **Umi-OCR** 的 HTTP API。

### 安装 Umi-OCR

1. 下载 [Umi-OCR](https://github.com/hiroi-sora/Umi-OCR)
2. 解压并运行

### 配置 HTTP 服务

1. 打开 Umi-OCR
2. 进入「设置」→「HTTP 服务」
3. 开启 HTTP 服务
4. 端口保持默认 `1224`

### 验证配置

浏览器访问 `http://127.0.0.1:1224`，能看到响应说明配置成功。

---

## 常见问题

### Q: 图片匹配总是失败？

**A:** 尝试以下方法：
1. 降低置信度到 0.6-0.7
2. 重新截图，确保截取的是按钮本身
3. 检查屏幕缩放比例是否与截图时一致
4. 使用截图工具的「测试图片匹配」功能调试

### Q: 中文输入乱码？

**A:** 程序使用剪贴板方式输入，正常情况下支持中文。如果出现问题：
1. 确保目标输入框支持粘贴
2. 检查系统剪贴板是否正常

### Q: 运行时鼠标乱动？

**A:** 这是正常现象，程序会模拟人类鼠标移动轨迹。运行期间请勿移动鼠标。

### Q: 定时任务没有执行？

**A:** 检查以下几点：
1. 电脑是否处于开机状态
2. Windows 任务计划程序服务是否正常
3. 运行 `schtasks /query | findstr AutoTask` 查看任务状态

### Q: OCR 识别失败？

**A:** 确保：
1. Umi-OCR 已启动
2. HTTP 服务已开启（端口 1224）
3. 识别区域坐标正确

### Q: 如何获取屏幕坐标？

**A:** 方法一：运行截图工具，输入 `m` 查看当前鼠标位置

方法二：使用 Python 获取
```python
import pyautogui
print(pyautogui.position())
```

---

## 文件结构

```
项目目录/
├── auto_task_gui.py      # 主程序（GUI）
├── auto_signin.py        # 核心自动化模块
├── capture_tool.py       # 截图工具
├── task_scheduler.py     # 定时任务管理
├── images/               # 图片模板目录
│   ├── btn_example.png
│   └── ...
├── tasks/                # 任务配置目录
│   ├── example.json
│   └── scheduler_config.json
└── README.md             # 本文档
```

---

## 联系与反馈

如有问题或建议，欢迎反馈！
